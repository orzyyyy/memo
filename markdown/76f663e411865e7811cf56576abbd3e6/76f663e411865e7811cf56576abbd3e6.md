<h3 id="需要解决的问题">需要解决的问题</h3>
<p>由于库存数量只能依靠人工估计，由此产生管理混乱的问题加大了对人员控制及物流成本。基于此，需要一套出入库记录系统及对一系列衍生数据的统计及分析工具。</p>
<h3 id="难点">难点</h3>
<ol>
<li>原有库存如何统计？</li>
</ol>
<p>原有库存数量巨大，记录所有材料数据粗略估计在三个月以上。而此间不能停止生产，所以这是一项长期任务。</p>
<p>目前解决方案为不统计实际存在的库存，只记录出入库数据。在所有材料被更新完毕之前，逐步地手动记录已存在库存并记录，以加快库存统计。</p>
<ol start="2">
<li>利润如何计算？</li>
</ol>
<p>由于原有库存无法统计，<strong>在计算利润时会有较大误差</strong>。而由于原有库存材料成本并无记录，误差一定存在，所以<strong>系统以尽量缩小误差为目标</strong>。需要获得精确利润时，仍需要实际存根才能计算。</p>
<p>目前解决方案为以交易时的市价为售出价，以交易材料最新一批的购入价为成本，由此计算单次交易的利润。</p>
<p>理想中的解决方案为，为所有新入库材料标记进价，原有库存则根据历史价格进行股价标码。交易时分情况计算利润。</p>
<ol start="3">
<li>应用部署及数据存储位置？</li>
</ol>
<ul>
<li>日常 pv 不过千，对服务器多为 I/O 操作</li>
<li>记录时需要在厂内</li>
<li>服务器至少需要服役五年</li>
<li>数据重要而不敏感</li>
</ul>
<p>家用主机即可满足需求，只需要更新主板内存扩展插槽及更新内存容量。由于 SSD 全盘可擦写次数底下，因此考虑数据库内存持久化方案。为了便于操作，录入时可以在手机上进行。因此应用应当部署在局域网中，便于针对性防范人为的记录混乱。数据库数据每日进行差量备份，在多名记录员的手机上进行物理备份，因此需要进行一定程度的加密。</p>
<h3 id="实施记录">实施记录</h3>
<ul>
<li>入库<ul>
<li>需要注意材料类型，圆形与方形重量由于计算方式不同，所以增加了下拉框以区分规格参数。圆形以长度 length 为直径，在计算时不需要宽度 width。</li>
<li>表单暂时只需要验证非空，所以没有加入表单插件。</li>
<li>每次记录时需要由服务端生成批号，前端每天只获取一次。存入 localStorage，并记录时间戳。此批号在保存成功后删除。如未保存成功，则需要记录所有已输入的表单数据，下次进入页面时自动填入。请求批号前需要验证时间戳与当前系统时间比较，超出前一天 24 时时，则需要重新请求批号；存入数据时，需要验证批号代表的日期是否与服务器日期为同一天。</li>
</ul>
</li>
</ul>
